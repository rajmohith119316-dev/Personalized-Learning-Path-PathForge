{% extends "base.html" %}

{% block content %}
<div class="register-page">
	<div class="register-container">
		<div class="register-header">
			<a href="/" class="back-link">
				<i data-lucide="arrow-left"></i>
				Back to Home
			</a>
			
			<h1>Create Your Account</h1>
			<p>Start your personalized learning journey today</p>
		</div>
		
		<form id="registerForm" class="register-form" onsubmit="handleRegister(event)">
			<div class="form-group">
				<label for="username">Username</label>
				<input type="text" id="username" name="username" required minlength="3">
				<span class="form-hint">At least 3 characters</span>
			</div>
			
			<div class="form-group">
				<label for="email">Email Address</label>
				<input type="email" id="email" name="email" required>
			</div>
			
			<div class="form-group">
				<label for="password">Password</label>
				<input type="password" id="password" name="password" required minlength="6">
				<span class="form-hint">At least 6 characters</span>
			</div>
			
			<div class="form-group">
				<label for="confirmPassword">Confirm Password</label>
				<input type="password" id="confirmPassword" name="confirmPassword" required>
			</div>
			
			<button type="submit" class="btn btn-primary btn-block btn-large">
				<i data-lucide="user-plus"></i>
				Create Account
			</button>
		</form>
		
		<div class="register-footer">
			<p>Already have an account? <a href="/">Login</a></p>
		</div>
	</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
	async function handleRegister(event) {
		event.preventDefault();
		
		const password = document.getElementById('password').value;
		const confirmPassword = document.getElementById('confirmPassword').value;
		
		if (password !== confirmPassword) {
			showToast('Passwords do not match', 'error');
			return;
		}
		
		const formData = {
			username: document.getElementById('username').value,
			email: document.getElementById('email').value,
			password: password
		};
		
		showLoading();
		
		try {
			const response = await fetch('/api/auth/register', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(formData)
			});
			
			const data = await response.json();
			
			if (response.ok) {
				localStorage.setItem('token', data.token);
				localStorage.setItem('user', JSON.stringify(data.user));
				showToast('Account created successfully!', 'success');
				
				setTimeout(() => {
					window.location.href = '/onboarding';
				}, 1000);
			} else {
				showToast(data.message || 'Registration failed', 'error');
			}
		} catch (error) {
			showToast('An error occurred. Please try again.', 'error');
		} finally {
			hideLoading();
		}
	}
</script>
{% endblock %}
